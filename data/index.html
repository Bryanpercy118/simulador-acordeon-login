<!DOCTYPE HTML>
<html lang="es">
<head>
    <title>Simulador de Acordeon | Huellas del Maestro</title>
    <link rel="icon" type="image/x-icon" href="icono.png">
    <meta name="Author" content="huellasdelmaestro.com">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@600;700&family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="lib/estilo.css" />
    <link rel="stylesheet" href="ui.css" />
    <script src="canciones.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.7.6/jquery.nicescroll.min.js" integrity="sha512-zMfrMAZYAlNClPKjN+JMuslK/B6sPM09BGvrWn9OVFD7MxI3/dVPQklE7tfqS+pLmPHF1zo6UdDaJAp/thihrf0c7w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
</head>
<body>
    <div>
        <div class="cargando" id="app-container">
            <!-- Menu deslizable -->
            <div id="menu-toggle" class="menu-toggle">
                <span title="Men√∫" class="material-symbols-outlined">menu</span>
            </div>

            <!-- Barra lateral izquierda -->
            <div id="sidebar" class="menu open">
                <div>
                    <span title="Men√∫" class="material-symbols-outlined" id="menu-close">menu</span>
                </div>

                <div class="control" id="cambiar-mano">
                    <div class="opcion seleccionada" id="mano-derecha" title="Seleccionar pitos">Diapas√≥n</div>
                    <div class="opcion" id="mano-izquierda" title="Seleccionar bajo">Bajos</div>
                    <div class="opcion" id="dos-manos" title="Seleccionar todo"></div>
                </div>

                <div class="control" id="cambiar-tono">
                    <div class="opcion seleccionada" title="Seleccionar ADG (La, Re, Sol)" id="tono-adg">ADG</div>
                    <div class="opcion" title="Seleccionar 5 Letras (Si bemol, Mi bemol, La bemol)" id="tono-5l">5L</div>
                    <div class="opcion" title="Seleccionar GCF (Sol, Do, Fa)" id="tono-gcf">GCF</div>
                </div>

                <div class="control" id="cambiar-modo">
                    <div class="opcion seleccionada" title="Modo de teclado" id="modo-teclado">
                        <span class="material-symbols-outlined">keyboard</span>
                    </div>

                    <div class="opcion" title="Notas musicales" id="modo-notas">
                        <span class="material-symbols-outlined">music_note</span>
                    </div>

                    <div class="opcion" title="Modo n√∫merico" id="modo-numero">
                        <span class="material-symbols-outlined">123</span>
                    </div>
                </div>

                <div id="composiciones">
                    <div class="fila" style="border-bottom: 1px solid silver; padding: 16px; display: flex; justify-content: space-between;">
                        <div>
                            <span class="material-symbols-outlined">queue_music</span>
                            <span>Ex√°men</span>
                        </div>
                        
                        <!-- <button class="reiniciar-pagina">
                            <span class="material-symbols-outlined" title="Actualizar">üîÑ</span>
                        </button> -->
                         <!-- Bot√≥n de borrar notas -->
                         <button id="btn-trash" title="Borrar Notas" style="background-color: transparent; border: none; color: inherit; cursor: pointer; padding: 8px; font-size: 10px;">
                            üóëÔ∏è Borrar Notas
                        </button>
                        
                    </div>

                    <div class="contenido" style="max-height: 400px; overflow-y: auto;"></div>

                    <div id="grabar" class="grabar">
                        <span class="text"></span>
                        <span class="material-symbols-outlined">sound_sampler</span>
                    </div>
                </div>

                <div id="melodias-guardadas" style="display: none; max-height: 400px; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; padding: 16px; border-bottom: 1px solid silver;">
                        <button class="volver-menu">
                            <span class="material-symbols-outlined" title="Volver">arrow_back</span>
                        </button>
                        <h3 style="margin: 0;">Melod√≠as Guardadas</h3>
                        <button class="nueva-melodia">
                            <span class="material-symbols-outlined" title="Nueva Melod√≠a">add</span>
                        </button>
                    </div>
                    <div class="lista-melodias" style="padding: 16px;"></div>
                </div>

                <a href="https://huellasdelmaestro.com/plataforma-virtual" title="Ir a la plataforma virtual" target="_blank">
                    <img class="logo" src="logo.png" />
                </a>

                <a class="link-pie" href="https://maps.app.goo.gl/ifKj8i46eAWydXzy9" target="_blank">
                    <div class="pie">
                        <span id="welcome-message"></span><br>
                        <span>Definitiva:</span>
                        <span id="definitive-grade"></span><br>
                    </div>
                </a>
            </div>

            <button class="btn-detener material-symbols-outlined">stop</button>
            
           

            <div class="contenidor">
                <div id="acordeon"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js" integrity="sha512-Siyxh4gyNM5SaERNa9BOZSPcu/auHyFUWn9OVFD7MxI3/dVPQklE7tfqS+pLmPHF1zo6UdDaJAp/thihrf0c7w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="lib/js/Acordeon/Acordeon.js"></script>
    <script src="lib/js/ui/ui.js"></script>
    <script src="lib/js/canciones.js/AsiFueMiQuerer.js"></script>
    <script src="canciones.js"></script>
    <script src="melodias.js"></script>
    <script>
       // Escucha el evento 'message' para recibir el displayName del usuario
        window.addEventListener('message', function(event) {
            if (event.data.displayName) {
                // Muestra el mensaje de bienvenida en el DOM
                document.getElementById('welcome-message').textContent = `Bienvenido: ${event.data.displayName}`;

                // Guarda el displayName en localStorage
                localStorage.setItem('displayName', event.data.displayName);
            }
        });

        function mostrarNotaYNombre() {
            const notaDefinitiva = parseFloat(localStorage.getItem('notaDefinitiva')) || 0;
            const displayName = JSON.parse(sessionStorage.getItem('bp_user') || '{}').displayname;
            document.getElementById('definitive-grade').textContent = notaDefinitiva;
            const Name = localStorage.getItem('displayName');

            if (notaDefinitiva > 1.0) {
                window.open(`https://certificado-generator.vercel.app/certificado?nombre=${encodeURIComponent(Name)}`, '_blank');
            }
            console.log('Display Name:', displayName);
        }

        document.addEventListener('DOMContentLoaded', function() {
            mostrarNotaYNombre();
        });

        document.getElementById('menu-toggle').addEventListener('click', function () {
            document.getElementById('sidebar').classList.toggle('open');
            document.querySelector('.contenidor').classList.toggle('expanded');
        });

        document.getElementById('menu-close').addEventListener('click', function () {
            document.getElementById('sidebar').classList.remove('open');
            document.querySelector('.contenidor').classList.remove('expanded');
        });

        // Funcionalidad del bot√≥n de borrar notas
        document.getElementById('btn-trash').addEventListener('click', function() {
            // Borrar los √≠tems 'notas' y 'notaDefinitiva' del localStorage
            localStorage.removeItem('notas');
            localStorage.removeItem('notaDefinitiva');

            // Mostrar un mensaje de confirmaci√≥n usando SweetAlert2
            Swal.fire({
                title: 'Notas eliminadas',
                text: 'Las notas guardadas han sido eliminadas correctamente.',
                icon: 'success',
                confirmButtonText: 'Aceptar'
            });

            // Recargar la p√°gina despu√©s de 8 segundos (8000 milisegundos)
            setTimeout(function() {
                location.reload();
            }, 8000);

            // Aqu√≠ puedes agregar cualquier otra acci√≥n que desees despu√©s de borrar las notas
        });

    </script>
</body>
</html>
